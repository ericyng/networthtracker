# Use Python 3.11 slim image
FROM python:3.11-slim

# Set work directory
WORKDIR /app

# Install system dependencies
RUN apt-get update \
    && apt-get install -y --no-install-recommends \
        gcc \
        g++ \
        postgresql-client \
        libpq-dev \
        pkg-config \
    && rm -rf /var/lib/apt/lists/*

# Install Python dependencies step by step
COPY requirements.minimal.txt requirements.txt

# Upgrade pip and install basic tools
RUN pip install --upgrade pip setuptools wheel

# Install packages one by one to identify the problematic one
RUN pip install Django==4.2.23
RUN pip install psycopg2-binary==2.9.9
RUN pip install gunicorn==21.2.0
RUN pip install requests==2.32.4

# Test if everything works
RUN python -c "import django; print('Django version:', django.get_version())"
RUN python -c "import psycopg2; print('psycopg2 installed successfully')"
RUN python -c "import gunicorn; print('gunicorn installed successfully')"
RUN python -c "import requests; print('requests installed successfully')" 